{"version":3,"file":"script.js","mappings":";;;;;;;;;;AAAa;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAe;AACf;;;;;;;;;;;ACZa;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;;;;;;;;;;;ACVF;AACb;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,yCAAyC,mBAAO,CAAC,iEAA0B;AAC3E,kCAAkC,mBAAO,CAAC,6CAAgB;AAC1D,wCAAwC,mBAAO,CAAC,+DAAyB;AACzE,yCAAyC,mBAAO,CAAC,iEAA0B;AAC3E;AACA;AACA;AACA;AACA;;;;;;;;;;;ACba;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D,cAAc,GAAG,aAAa;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,cAAc;;;;;;;;;;;AChGD;AACb;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,kCAAkC,mBAAO,CAAC,8CAAiB;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAe;;;;;;;;;;;ACjBF;AACb;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,kCAAkC,mBAAO,CAAC,8CAAiB;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAe;;;;;;;;;;;ACpBF;AACb;AACA;AACA,mCAAmC,oCAAoC,gBAAgB;AACvF,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,0CAA0C,4BAA4B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,kCAAkC,mBAAO,CAAC,8CAAiB;AAC3D,4BAA4B,mBAAO,CAAC,8BAAS;AAC7C,gBAAgB,mBAAO,CAAC,0CAAe;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,oCAAoC;AAC9E,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,+DAA+D,kEAAkE;AACjI;AACA;AACA,+DAA+D,kEAAkE;AACjI;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAe;;;;;;;UC9Hf;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;UEtBA;UACA;UACA;UACA","sources":["webpack://visual-scripting-sandbox/./src/core/service.ts","webpack://visual-scripting-sandbox/./src/core/utils.ts","webpack://visual-scripting-sandbox/./src/index.ts","webpack://visual-scripting-sandbox/./src/node.ts","webpack://visual-scripting-sandbox/./src/service/camera.service.ts","webpack://visual-scripting-sandbox/./src/service/debug.service.ts","webpack://visual-scripting-sandbox/./src/service/render.service.ts","webpack://visual-scripting-sandbox/webpack/bootstrap","webpack://visual-scripting-sandbox/webpack/before-startup","webpack://visual-scripting-sandbox/webpack/startup","webpack://visual-scripting-sandbox/webpack/after-startup"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nclass Service {\r\n    static provide(instance) {\r\n        Service.services.set(instance.constructor.name, instance);\r\n        return instance;\r\n    }\r\n    static retrieve(clazz) {\r\n        return Service.services.get(clazz.name);\r\n    }\r\n}\r\nexports.default = Service;\r\nService.services = new Map();\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.roundUp = void 0;\r\n// eslint-disable-next-line import/prefer-default-export\r\nconst roundUp = (x, threshold = 100) => {\r\n    if (x >= 0) {\r\n        return x % threshold === 0 ? x : x + threshold - (x % threshold);\r\n    }\r\n    return x % threshold === 0 ? x : x - (x % threshold);\r\n};\r\nexports.roundUp = roundUp;\r\n","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst camera_service_1 = __importDefault(require(\"./service/camera.service\"));\r\nconst service_1 = __importDefault(require(\"./core/service\"));\r\nconst debug_service_1 = __importDefault(require(\"./service/debug.service\"));\r\nconst render_service_1 = __importDefault(require(\"./service/render.service\"));\r\nconst debug = service_1.default.provide(new debug_service_1.default());\r\nconst camera = service_1.default.provide(new camera_service_1.default(-window.innerWidth / 2, -window.innerHeight / 2));\r\nconst canvas = document.getElementById('main-canvas');\r\nconst render = service_1.default.provide(new render_service_1.default(camera, debug, canvas));\r\nrender.draw();\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Output = exports.Input = void 0;\r\nconst HEADER_MARGIN = 25;\r\nclass Node {\r\n    constructor(name, x = 0, y = 0) {\r\n        this._inputs = [];\r\n        this._outputs = [];\r\n        this.name = name;\r\n        this.x = x;\r\n        this.y = y;\r\n        this._canBeDragged = false;\r\n    }\r\n    addInput(input) {\r\n        this._inputs.push(input);\r\n        return this;\r\n    }\r\n    addOutput(output) {\r\n        this._outputs.push(output);\r\n        return this;\r\n    }\r\n    interact(event, x, y) {\r\n        this._canBeDragged = false;\r\n        if (this._inHeaderBounds(x, y)) {\r\n            this._canBeDragged = true;\r\n        }\r\n        else if (this._inBodyBounds(x, y)) {\r\n            // Nothing so far ...\r\n        }\r\n    }\r\n    move(event, deltaX, deltaY) {\r\n        if (!this._canBeDragged)\r\n            return;\r\n        this.x += deltaX;\r\n        this.y += deltaY;\r\n    }\r\n    mouseHover(event, x, y) {\r\n        if (this._inHeaderBounds(x, y)) {\r\n            document.body.style.cursor = 'grab';\r\n        }\r\n        else {\r\n            document.body.style.cursor = 'default';\r\n        }\r\n    }\r\n    draw(context, camera) {\r\n        context.fillStyle = 'red';\r\n        this.width = 100;\r\n        this.height = Math.max(HEADER_MARGIN +\r\n            10 +\r\n            Math.max(this._inputs.length, this._outputs.length) * 20, 60);\r\n        context.fillRect(this.x - camera.x, this.y - camera.y, this.width, this.height);\r\n        context.font = '18px arial';\r\n        context.textAlign = 'center';\r\n        context.fillStyle = 'white';\r\n        context.fillText(this.name, this.x + 50 - camera.x, this.y + 15 - camera.y, this.width);\r\n        this._inputs.forEach((input, index) => {\r\n            context.fillStyle = 'purple';\r\n            context.fillRect(this.x + 5 - camera.x, this.y + HEADER_MARGIN + index * 22 - camera.y, 20, 20);\r\n        });\r\n        this._outputs.forEach((output, index) => {\r\n            context.fillStyle = 'cyan';\r\n            context.fillRect(this.x + this.width - 20 - 5 - camera.x, this.y + HEADER_MARGIN + index * 10 - camera.y, 20, 20);\r\n        });\r\n    }\r\n    inBounds(x, y) {\r\n        return (x > this.x &&\r\n            x < this.x + this.width &&\r\n            y > this.y &&\r\n            y < this.y + this.height);\r\n    }\r\n    _inHeaderBounds(x, y) {\r\n        return (x > this.x &&\r\n            x < this.x + this.width &&\r\n            y > this.y &&\r\n            y < this.y + HEADER_MARGIN);\r\n    }\r\n    _inBodyBounds(x, y) {\r\n        return (x > this.x &&\r\n            x < this.x + this.width &&\r\n            y > this.y + HEADER_MARGIN &&\r\n            y < this.y + this.height);\r\n    }\r\n}\r\nexports.default = Node;\r\nclass Input {\r\n    constructor(name, defaultValue = undefined) {\r\n        this.name = name;\r\n        this.defaultValue = defaultValue;\r\n    }\r\n}\r\nexports.Input = Input;\r\nclass Output {\r\n    constructor(name) {\r\n        this.name = name;\r\n    }\r\n}\r\nexports.Output = Output;\r\n","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst service_1 = __importDefault(require(\"../core/service\"));\r\nclass CameraService extends service_1.default {\r\n    constructor(x = 0, y = 0) {\r\n        super();\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n    move(deltaX, deltaY) {\r\n        this.x += deltaX;\r\n        this.y += deltaY;\r\n    }\r\n}\r\nexports.default = CameraService;\r\n","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst service_1 = __importDefault(require(\"../core/service\"));\r\nclass DebugService extends service_1.default {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.debug = (...args) => {\r\n            this.debugElement.innerText = args.join('');\r\n        };\r\n    }\r\n    get debugElement() {\r\n        if (!this._debugElement) {\r\n            this._debugElement = document.getElementById('debug');\r\n        }\r\n        return this._debugElement;\r\n    }\r\n}\r\nexports.default = DebugService;\r\n","\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst service_1 = __importDefault(require(\"../core/service\"));\r\nconst node_1 = __importStar(require(\"../node\"));\r\nconst utils_1 = require(\"../core/utils\");\r\nclass RenderService extends service_1.default {\r\n    constructor(camera, debugService, canvas) {\r\n        super();\r\n        this.resize = () => {\r\n            this.canvas.width = window.innerWidth;\r\n            this.canvas.height = window.innerHeight;\r\n            this.bounds = this.canvas.getBoundingClientRect();\r\n            this.camera.width = this.bounds.width;\r\n            this.camera.height = this.bounds.height;\r\n            requestAnimationFrame(this.draw);\r\n        };\r\n        this.draw = () => {\r\n            this.debugService.debug('x: ', this.camera.x, ', y: ', this.camera.y);\r\n            this.context.clearRect(0, 0, this.bounds.width, this.bounds.height);\r\n            this.drawBackgroundGraph();\r\n            this.context.fillStyle = '#FF0000';\r\n            this.nodes.forEach((node) => {\r\n                node.draw(this.context, { x: this.camera.x, y: this.camera.y });\r\n            });\r\n        };\r\n        this.updateCursorStyleOnNodeHover = (event) => {\r\n            const x = event.offsetX + this.camera.x;\r\n            const y = event.offsetY + this.camera.y;\r\n            const targetNode = this.nodes.find((node) => node.inBounds(x, y));\r\n            if (targetNode) {\r\n                targetNode.mouseHover(event, x, y);\r\n            }\r\n            else {\r\n                document.body.style.cursor = 'default';\r\n            }\r\n        };\r\n        this.camera = camera;\r\n        this.debugService = debugService;\r\n        this.canvas = canvas;\r\n        this.context = canvas.getContext('2d');\r\n        this.mouseHeld = false;\r\n        this.oldMouseX = 0;\r\n        this.oldMouseY = 0;\r\n        this.nodes = [\r\n            new node_1.default('sysout')\r\n                .addInput(new node_1.Input('text', 'hello world'))\r\n                .addInput(new node_1.Input('text', 'hello world'))\r\n                .addInput(new node_1.Input('text', 'hello world'))\r\n                .addOutput(new node_1.Output('text'))\r\n        ];\r\n        this.initListeners();\r\n        this.resize();\r\n    }\r\n    initListeners() {\r\n        window.addEventListener('load', this.resize);\r\n        window.addEventListener('resize', this.resize);\r\n        window.addEventListener('mouseup', () => {\r\n            this.mouseHeld = false;\r\n            this.targetNode = undefined;\r\n        });\r\n        window.addEventListener('focusout', () => (this.mouseHeld = false));\r\n        window.addEventListener('mousemove', this.updateCursorStyleOnNodeHover);\r\n        window.addEventListener('mousemove', (event) => {\r\n            const mouseX = event.clientX - this.bounds.left;\r\n            const mouseY = event.clientY - this.bounds.top;\r\n            const mouseDeltaX = this.oldMouseX - mouseX;\r\n            const mouseDeltaY = this.oldMouseY - mouseY;\r\n            if (this.mouseHeld) {\r\n                this.camera.move(mouseDeltaX, mouseDeltaY);\r\n                requestAnimationFrame(this.draw);\r\n            }\r\n            else if (this.targetNode) {\r\n                this.targetNode.move(event, -mouseDeltaX, -mouseDeltaY);\r\n                requestAnimationFrame(this.draw);\r\n            }\r\n            this.oldMouseX = mouseX;\r\n            this.oldMouseY = mouseY;\r\n        });\r\n        this.canvas.addEventListener('mousedown', (event) => {\r\n            const localX = event.offsetX + this.camera.x;\r\n            const localY = event.offsetY + this.camera.y;\r\n            this.targetNode = this.nodes.find((node) => node.inBounds(localX, localY));\r\n            if (this.targetNode) {\r\n                this.targetNode.interact(event, localX, localY);\r\n            }\r\n            else {\r\n                this.mouseHeld = true;\r\n            }\r\n        });\r\n        this.canvas.addEventListener('focusout', () => (this.mouseHeld = false));\r\n    }\r\n    drawBackgroundGraph() {\r\n        this.context.fillStyle = 'rgba(220, 220, 220, 0.2)';\r\n        for (let startX = (0, utils_1.roundUp)(this.camera.x); startX < this.bounds.width + (0, utils_1.roundUp)(this.camera.x); startX += 100) {\r\n            this.context.fillRect(startX - this.camera.x, 0, 1, this.bounds.height);\r\n        }\r\n        for (let startY = (0, utils_1.roundUp)(this.camera.y); startY < this.bounds.width + (0, utils_1.roundUp)(this.camera.y); startY += 100) {\r\n            this.context.fillRect(0, startY - this.camera.y, this.bounds.width, 1);\r\n        }\r\n        this.context.fillStyle = 'rgba(200, 200, 200, 0.6)';\r\n        this.context.fillRect(-this.camera.x, 0, 3, this.bounds.height);\r\n        this.context.fillRect(0, -this.camera.y, this.bounds.width, 3);\r\n    }\r\n}\r\nexports.default = RenderService;\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(\"./src/index.ts\");\n",""],"names":[],"sourceRoot":""}